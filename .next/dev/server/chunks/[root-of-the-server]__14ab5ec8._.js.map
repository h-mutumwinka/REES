{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/byiri/Music/RuralEducation/app/api/auth/signup/route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport Database from \"better-sqlite3\"\nimport crypto from \"crypto\"\nimport path from \"path\"\n\nlet db: Database.Database\n\nfunction getDb() {\n  if (!db) {\n    const dbPath = path.join(process.cwd(), \"rees.db\")\n    db = new Database(dbPath)\n    // Initialize schema\n    const schema = `\n      CREATE TABLE IF NOT EXISTS users (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        name TEXT NOT NULL,\n        email TEXT UNIQUE NOT NULL,\n        password TEXT NOT NULL,\n        phone TEXT,\n        role TEXT NOT NULL CHECK(role IN ('student', 'teacher', 'admin')),\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP\n      );\n      CREATE TABLE IF NOT EXISTS courses (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        title TEXT NOT NULL,\n        description TEXT,\n        subject TEXT NOT NULL,\n        grade_level TEXT NOT NULL,\n        teacher_id INTEGER NOT NULL,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        updated_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (teacher_id) REFERENCES users(id)\n      );\n      CREATE TABLE IF NOT EXISTS course_materials (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        course_id INTEGER NOT NULL,\n        title TEXT NOT NULL,\n        content TEXT NOT NULL,\n        material_type TEXT NOT NULL CHECK(material_type IN ('lesson', 'video', 'assignment', 'resource')),\n        file_url TEXT,\n        order_index INTEGER DEFAULT 0,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        FOREIGN KEY (course_id) REFERENCES courses(id)\n      );\n      CREATE TABLE IF NOT EXISTS enrollments (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        student_id INTEGER NOT NULL,\n        course_id INTEGER NOT NULL,\n        enrolled_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        UNIQUE(student_id, course_id),\n        FOREIGN KEY (student_id) REFERENCES users(id),\n        FOREIGN KEY (course_id) REFERENCES courses(id)\n      );\n      CREATE TABLE IF NOT EXISTS progress (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        student_id INTEGER NOT NULL,\n        material_id INTEGER NOT NULL,\n        completed BOOLEAN DEFAULT FALSE,\n        completed_at DATETIME,\n        created_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        UNIQUE(student_id, material_id),\n        FOREIGN KEY (student_id) REFERENCES users(id),\n        FOREIGN KEY (material_id) REFERENCES course_materials(id)\n      );\n      CREATE TABLE IF NOT EXISTS submissions (\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\n        student_id INTEGER NOT NULL,\n        material_id INTEGER NOT NULL,\n        submission_text TEXT,\n        submission_file_url TEXT,\n        grade INTEGER,\n        feedback TEXT,\n        submitted_at DATETIME DEFAULT CURRENT_TIMESTAMP,\n        graded_at DATETIME,\n        FOREIGN KEY (student_id) REFERENCES users(id),\n        FOREIGN KEY (material_id) REFERENCES course_materials(id)\n      );\n    `\n    db.exec(schema)\n  }\n  return db\n}\n\nfunction hashPassword(password: string): string {\n  return crypto.createHash(\"sha256\").update(password).digest(\"hex\")\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const { name, email, password, phone, role } = await request.json()\n\n    if (!name || !email || !password || !role) {\n      return NextResponse.json({ error: \"Missing required fields\" }, { status: 400 })\n    }\n\n    const database = getDb()\n\n    // Check if email already exists\n    const existingUser = database.prepare(\"SELECT id FROM users WHERE email = ?\").get(email)\n    if (existingUser) {\n      return NextResponse.json({ error: \"Email already registered\" }, { status: 400 })\n    }\n\n    // Create new user\n    const insert = database.prepare(`\n      INSERT INTO users (name, email, password, phone, role)\n      VALUES (?, ?, ?, ?, ?)\n    `)\n\n    const result = insert.run(name, email, hashPassword(password), phone || null, role)\n\n    return NextResponse.json({\n      userId: result.lastInsertRowid,\n      role,\n    })\n  } catch (error) {\n    console.error(\"Signup error:\", error)\n    return NextResponse.json({ error: \"Server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,IAAI;AAEJ,SAAS;IACP,IAAI,CAAC,IAAI;QACP,MAAM,SAAS,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QACxC,KAAK,IAAI,sIAAQ,CAAC;QAClB,oBAAoB;QACpB,MAAM,SAAS,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;IAkEhB,CAAC;QACD,GAAG,IAAI,CAAC;IACV;IACA,OAAO;AACT;AAEA,SAAS,aAAa,QAAgB;IACpC,OAAO,gHAAM,CAAC,UAAU,CAAC,UAAU,MAAM,CAAC,UAAU,MAAM,CAAC;AAC7D;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,GAAG,MAAM,QAAQ,IAAI;QAEjE,IAAI,CAAC,QAAQ,CAAC,SAAS,CAAC,YAAY,CAAC,MAAM;YACzC,OAAO,2KAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA0B,GAAG;gBAAE,QAAQ;YAAI;QAC/E;QAEA,MAAM,WAAW;QAEjB,gCAAgC;QAChC,MAAM,eAAe,SAAS,OAAO,CAAC,wCAAwC,GAAG,CAAC;QAClF,IAAI,cAAc;YAChB,OAAO,2KAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2B,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,kBAAkB;QAClB,MAAM,SAAS,SAAS,OAAO,CAAC,CAAC;;;IAGjC,CAAC;QAED,MAAM,SAAS,OAAO,GAAG,CAAC,MAAM,OAAO,aAAa,WAAW,SAAS,MAAM;QAE9E,OAAO,2KAAY,CAAC,IAAI,CAAC;YACvB,QAAQ,OAAO,eAAe;YAC9B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,iBAAiB;QAC/B,OAAO,2KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF"}}]
}